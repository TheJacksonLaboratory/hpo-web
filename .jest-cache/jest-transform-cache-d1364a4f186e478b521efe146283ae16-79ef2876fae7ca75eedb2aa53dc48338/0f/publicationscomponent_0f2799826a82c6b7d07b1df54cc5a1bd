250a75bdf15c80c8e36d6d23bf96e091
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PublicationsComponent = void 0;
const tslib_1 = require("tslib");
const core_1 = require("@angular/core");
const publications_service_1 = require("./publications.service");
const forms_1 = require("@angular/forms");
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const table_1 = require("@angular/material/table");
const sort_1 = require("@angular/material/sort");
let PublicationsComponent = class PublicationsComponent {
    constructor(pubService) {
        this.pubService = pubService;
        this.displayedColumns = ['authors', 'year', 'title', 'journal'];
        this.category = 'all';
        this.topics = new forms_1.UntypedFormControl();
        this.topicList = [];
    }
    ngOnInit() {
        this.pubService.getPublications().subscribe(publications => {
            this.publications = new table_1.MatTableDataSource(publications);
            this.publications.sort = this.sort;
            this.publications.filterPredicate = this.filterPredicate;
            this.findUniquePublicationTopics(publications);
        });
    }
    findUniquePublicationTopics(pbs) {
        const topics$ = (0, rxjs_1.from)(pbs);
        topics$.pipe((0, operators_1.mergeMap)(pb => pb.topicList), (0, operators_1.distinct)(), (0, operators_1.map)(pb => pb.toUpperCase()), (0, operators_1.toArray)()).subscribe(publications => {
            this.topicList = publications;
        });
    }
    filterPredicate(data, filter) {
        const filterVal = filter.split('~');
        const matchesCategory = function (item, category) {
            return (category === 'all' || (category === 'us' && item.inhouse === true));
        };
        // Filter by category first
        const categoryBoolean = matchesCategory(data, filterVal[0]);
        if (categoryBoolean === false) {
            return false;
        }
        // Filter by tag
        const topicSize = filterVal[1].split(',')[0] === '' || filterVal[1].split(',')[0] === 'null' ? 0 : filterVal[1].split(',').length;
        const topicBool = data.topicList.map(topic => {
            return filterVal[1].includes(topic.toUpperCase());
        });
        if (topicSize < data.topicList.length) {
            return topicBool.filter(x => x).length === topicSize;
        }
        else if (topicSize === data.topicList.length) {
            return topicBool.every(x => x === true);
        }
        else if (topicSize === 0) {
            return true;
        }
        return false;
    }
    applyPublicationsFilter() {
        this.publications.filter = this.category + '~' + this.topics.value;
    }
    static { this.ctorParameters = () => [
        { type: publications_service_1.PublicationsService }
    ]; }
    static { this.propDecorators = {
        sort: [{ type: core_1.ViewChild, args: [sort_1.MatSort, { static: true },] }]
    }; }
};
exports.PublicationsComponent = PublicationsComponent;
exports.PublicationsComponent = PublicationsComponent = tslib_1.__decorate([
    (0, core_1.Component)({
        selector: 'app-publications',
        template: require("./publications.component.html")
    }),
    tslib_1.__metadata("design:paramtypes", [publications_service_1.PublicationsService])
], PublicationsComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dhcmdhbS9EZXZlbG9wL2hwby13ZWIvc3JjL2FwcC9zdGF0aWMvcmVzb3VyY2VzL3B1YmxpY2F0aW9ucy9wdWJsaWNhdGlvbnMuY29tcG9uZW50LnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQSx3Q0FBNkQ7QUFDN0QsaUVBQTZEO0FBRTdELDBDQUFvRDtBQUNwRCwrQkFBNEI7QUFDNUIsOENBQWtFO0FBQ2xFLG1EQUE2RDtBQUM3RCxpREFBaUQ7QUFRMUMsSUFBTSxxQkFBcUIsR0FBM0IsTUFBTSxxQkFBcUI7SUFJaEMsWUFBb0IsVUFBK0I7UUFBL0IsZUFBVSxHQUFWLFVBQVUsQ0FBcUI7UUFHbkQscUJBQWdCLEdBQWEsQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztRQUNyRSxhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLFdBQU0sR0FBRyxJQUFJLDBCQUFrQixFQUFFLENBQUM7UUFDbEMsY0FBUyxHQUFHLEVBQUUsQ0FBQztJQUxmLENBQUM7SUFRRCxRQUFRO1FBQ04sSUFBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLEVBQUU7WUFDekQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLDBCQUFrQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3pELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDbkMsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztZQUN6RCxJQUFJLENBQUMsMkJBQTJCLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsMkJBQTJCLENBQUMsR0FBa0I7UUFDNUMsTUFBTSxPQUFPLEdBQUcsSUFBQSxXQUFJLEVBQUMsR0FBRyxDQUFDLENBQUM7UUFDMUIsT0FBTyxDQUFDLElBQUksQ0FDVixJQUFBLG9CQUFRLEVBQUMsRUFBRSxD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VXNlcnMvZ2FyZ2FtL0RldmVsb3AvaHBvLXdlYi9zcmMvYXBwL3N0YXRpYy9yZXNvdXJjZXMvcHVibGljYXRpb25zL3B1YmxpY2F0aW9ucy5jb21wb25lbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUHVibGljYXRpb25zU2VydmljZSB9IGZyb20gJy4vcHVibGljYXRpb25zLnNlcnZpY2UnO1xuaW1wb3J0IHsgUHVibGljYXRpb24gfSBmcm9tICcuLi8uLi8uLi9icm93c2VyL21vZGVscy9tb2RlbHMnO1xuaW1wb3J0IHsgVW50eXBlZEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgZnJvbSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGlzdGluY3QsIG1lcmdlTWFwLCBtYXAsIHRvQXJyYXkgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBNYXRUYWJsZURhdGFTb3VyY2UgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC90YWJsZSc7XG5pbXBvcnQgeyBNYXRTb3J0IH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc29ydCc7XG5cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYXBwLXB1YmxpY2F0aW9ucycsXG4gIHRlbXBsYXRlVXJsOiAnLi9wdWJsaWNhdGlvbnMuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9wdWJsaWNhdGlvbnMuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBQdWJsaWNhdGlvbnNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIHB1YmxpY2F0aW9uczogTWF0VGFibGVEYXRhU291cmNlPFB1YmxpY2F0aW9uPjtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHB1YlNlcnZpY2U6IFB1YmxpY2F0aW9uc1NlcnZpY2UpIHtcbiAgfVxuXG4gIGRpc3BsYXllZENvbHVtbnM6IHN0cmluZ1tdID0gWydhdXRob3JzJywgJ3llYXInLCAndGl0bGUnLCAnam91cm5hbCddO1xuICBjYXRlZ29yeSA9ICdhbGwnO1xuICB0b3BpY3MgPSBuZXcgVW50eXBlZEZvcm1Db250cm9sKCk7XG4gIHRvcGljTGlzdCA9IFtdO1xuICBAVmlld0NoaWxkKE1hdFNvcnQsIHsgc3RhdGljOiB0cnVlIH0pIHNvcnQ6IE1hdFNvcnQ7XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5wdWJTZXJ2aWNlLmdldFB1YmxpY2F0aW9ucygpLnN1YnNjcmliZShwdWJsaWNhdGlvbnMgPT4ge1xuICAgICAgdGhpcy5wdWJsaWNhdGlvbnMgPSBuZXcgTWF0VGFibGVEYXRhU291cmNlKHB1YmxpY2F0aW9ucyk7XG4gICAgICB0aGlzLnB1YmxpY2F0aW9ucy5zb3J0ID0gdGhpcy5zb3J0O1xuICAgICAgdGhpcy5wdWJsaWNhdGlvbnMuZmlsdGVyUHJlZGljYXRlID0gdGhpcy5maWx0ZXJQcmVkaWNhdGU7XG4gICAgICB0aGlzLmZpbmRVbmlxdWVQdWJsaWNhdGlvblRvcGljcyhwdWJsaWNhdGlvbnMpO1xuICAgIH0pO1xuICB9XG5cbiAgZmluZFVuaXF1ZVB1YmxpY2F0aW9uVG9waWNzKHBiczogUHVibGljYXRpb25bXSkge1xuICAgIGNvbnN0IHRvcGljcyQgPSBmcm9tKHBicyk7XG4gICAgdG9waWNzJC5waXBlKFxuICAgICAgbWVyZ2VNYXAocGIgPT4gcGIudG9waWNMaXN0KSxcbiAgICAgIGRpc3RpbmN0KCksXG4gICAgICBtYXAocGIgPT4gcGIudG9VcHBlckNhc2UoKSksXG4gICAgICB0b0FycmF5KClcbiAgICApLnN1YnNjcmliZShwdWJsaWNhdGlvbnMgPT4ge1xuICAgICAgdGhpcy50b3BpY0xpc3QgPSBwdWJsaWNhdGlvbnM7XG4gICAgfSk7XG4gIH1cblxuICBmaWx0ZXJQcmVkaWNhdGUoZGF0YTogUHVibGljYXRpb24sIGZpbHRlcjogc3RyaW5nKSB7XG4gICAgY29uc3QgZmlsdGVyVmFsID0gZmlsdGVyLnNwbGl0KCd+Jyk7XG4gICAgY29uc3QgbWF0Y2hlc0NhdGVnb3J5ID0gZnVuY3Rpb24gKGl0ZW06IFB1YmxpY2F0aW9uLCBjYXRlZ29yeTogc3RyaW5nKSB7XG4gICAgICByZXR1cm4gKGNhdGVnb3J5ID09PSAnYWxsJyB8fCAoY2F0ZWdvcnkgPT09ICd1cycgJiYgaXRlbS5pbmhvdXNlID09PSB0cnVlKSk7XG4gICAgfTtcblxuICAgIC8vIEZpbHRlciBieSBjYXRlZ29yeSBmaXJzdFxuICAgIGNvbnN0IGNhdGVnb3J5Qm9vbGVhbiA9IG1hdGNoZXNDYXRlZ29yeShkYXRhLCBmaWx0ZXJWYWxbMF0pO1xuXG4gICAgaWYgKGNhdGVnb3J5Qm9vbGVhbiA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBGaWx0ZXIgYnkgdGFnXG4gICAgY29uc3QgdG9waWNTaXplID0gZmlsdGVyVmFsWzFdLnNwbGl0KCcsJylbMF0gPT09ICcnIHx8IGZpbHRlclZhbFsxXS5zcGxpdCgnLCcpWzBdID09PSAnbnVsbCcgPyAwIDogZmlsdGVyVmFsWzFdLnNwbGl0KCcsJykubGVuZ3RoO1xuICAgIGNvbnN0IHRvcGljQm9vbCA9IGRhdGEudG9waWNMaXN0Lm1hcCh0b3BpYyA9PiB7XG4gICAgICByZXR1cm4gZmlsdGVyVmFsWzFdLmluY2x1ZGVzKHRvcGljLnRvVXBwZXJDYXNlKCkpO1xuICAgIH0pO1xuXG4gICAgaWYgKHRvcGljU2l6ZSA8IGRhdGEudG9waWNMaXN0Lmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHRvcGljQm9vbC5maWx0ZXIoeCA9PiB4KS5sZW5ndGggPT09IHRvcGljU2l6ZTtcbiAgICB9IGVsc2UgaWYgKHRvcGljU2l6ZSA9PT0gZGF0YS50b3BpY0xpc3QubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gdG9waWNCb29sLmV2ZXJ5KHggPT4geCA9PT0gdHJ1ZSk7XG4gICAgfSBlbHNlIGlmICh0b3BpY1NpemUgPT09IDApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBhcHBseVB1YmxpY2F0aW9uc0ZpbHRlcigpIHtcbiAgICB0aGlzLnB1YmxpY2F0aW9ucy5maWx0ZXIgPSB0aGlzLmNhdGVnb3J5ICsgJ34nICsgdGhpcy50b3BpY3MudmFsdWU7XG4gIH1cblxufVxuIl0sInZlcnNpb24iOjN9