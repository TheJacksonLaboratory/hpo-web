5ada1f2e624eacbd63acc4b8736452a5
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProfileSearchComponent = void 0;
const tslib_1 = require("tslib");
const core_1 = require("@angular/core");
const table_1 = require("@angular/material/table");
const rxjs_1 = require("rxjs");
const forms_1 = require("@angular/forms");
const operators_1 = require("rxjs/operators");
const annotation_service_1 = require("../../services/annotation/annotation.service");
const ontology_service_1 = require("../../services/ontology/ontology.service");
const stepper_1 = require("@angular/material/stepper");
const sort_1 = require("@angular/material/sort");
let ProfileSearchComponent = class ProfileSearchComponent {
    constructor(ontologyService, annotationService) {
        this.ontologyService = ontologyService;
        this.annotationService = annotationService;
        this.myControl = new forms_1.UntypedFormControl();
        this.selectedTerms = [];
        this.submittedTerms = false;
        this.loadingIntersectingAssociations = true;
        this.intersectingAssocationError = false;
        this.displayedColumns = ['diseaseId', 'diseaseName'];
        this.resultsLength = 0;
    }
    ngOnInit() {
        this.filteredOptions = this.myControl.valueChanges
            .pipe((0, operators_1.filter)(x => x != null && x != '' && x.length >= 3), (0, operators_1.switchMap)(val => this.ontologyService.search(val, 10)), (0, operators_1.map)(response => response.terms));
    }
    addTerm(term) {
        if (!this.selectedTerms.some(existent => existent.id == term.id)) {
            this.selectedTerms.push(term);
        }
    }
    removeTerm(index) {
        this.selectedTerms.splice(index);
    }
    submitTerms() {
        this.stepper.next();
        this.submittedTerms = true;
        this.loadingIntersectingAssociations = true;
        let termIds = this.selectedTerms.map(term => term.id);
        this.annotationService.searchProfile(termIds.join(",")).pipe((0, operators_1.debounceTime)(1000), (0, operators_1.distinctUntilChanged)(), (0, operators_1.map)(data => {
            this.loadingIntersectingAssociations = false;
            this.resultsLength = data.length;
            return data;
        }), (0, operators_1.catchError)(() => {
            this.intersectingAssocationError = true;
            this.loadingIntersectingAssociations = false;
            return (0, rxjs_1.of)([]);
        })).subscribe(data => this.dataSource = new table_1.MatTableDataSource(data));
    }
    applyTermFilter(filterValue) {
        filterValue = filterValue.trim(); // Remove whitespace
        filterValue = filterValue.toLowerCase(); // MatTableDataSource defaults to lowercase matches
        this.dataSource.filter = filterValue;
    }
    resetStepper() {
        this.stepper.reset();
        this.submittedTerms = false;
        this.selectedTerms = [];
        this.myControl.reset();
    }
    static { this.ctorParameters = () => [
        { type: ontology_service_1.OntologyService },
        { type: annotation_service_1.AnnotationService }
    ]; }
    static { this.propDecorators = {
        stepper: [{ type: core_1.ViewChild, args: ['stepper',] }],
        sort: [{ type: core_1.ViewChild, args: [sort_1.MatSort,] }]
    }; }
};
exports.ProfileSearchComponent = ProfileSearchComponent;
exports.ProfileSearchComponent = ProfileSearchComponent = tslib_1.__decorate([
    (0, core_1.Component)({
        selector: 'app-custom',
        template: require("./profile-search.component.html")
    }),
    tslib_1.__metadata("design:paramtypes", [ontology_service_1.OntologyService, annotation_service_1.AnnotationService])
], ProfileSearchComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dhcmdhbS9EZXZlbG9wL2hwby13ZWIvc3JjL2FwcC9icm93c2VyL3BhZ2VzL3Byb2ZpbGUtc2VhcmNoL3Byb2ZpbGUtc2VhcmNoLmNvbXBvbmVudC50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsd0NBQTZEO0FBQzdELG1EQUE2RDtBQUM3RCwrQkFBc0M7QUFDdEMsMENBQW9EO0FBQ3BELDhDQUF3RztBQUN4RyxxRkFBaUY7QUFDakYsK0VBQTJFO0FBQzNFLHVEQUF1RDtBQUN2RCxpREFBaUQ7QUFRMUMsSUFBTSxzQkFBc0IsR0FBNUIsTUFBTSxzQkFBc0I7SUFnQmpDLFlBQW9CLGVBQWdDLEVBQVcsaUJBQW9DO1FBQS9FLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUFXLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFYbkcsY0FBUyxHQUFHLElBQUksMEJBQWtCLEVBQUUsQ0FBQztRQUVyQyxrQkFBYSxHQUFpQixFQUFFLENBQUM7UUFDakMsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFHdkIsb0NBQStCLEdBQUcsSUFBSSxDQUFDO1FBQ3ZDLGdDQUEyQixHQUFHLEtBQUssQ0FBQztRQUNwQyxxQkFBZ0IsR0FBYSxDQUFDLFdBQVcsRUFBRSxhQUFhLENBQUMsQ0FBQztRQUMxRCxrQkFBYSxHQUFHLENBQUMsQ0FBQztJQUdsQixDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZO2FBQy9DLElBQUksQ0FDSCxJQUFBLGtCQUFNLEVBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsRUFDbEQsSUFBQSxxQkFBUyxFQUFDLEdBQUcsQ0FBQyxFQUFFLENBQ2QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUNyQyxFQUNELElBQUEsZUFBRyxFQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUNoQyxDQUFDO0lBQ04sQ0FBQztJQUVELE9BQU8sQ0FBQyxJQUFTO1FBQ2YsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNqRSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxDQUFDO0lBQ0gsQ0FBQztJQUVELFVBQVUsQ0FBQyxLQUFhO1FBQ3RCLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztRQUMzQixJQUFJLENBQUMsK0JBQStCLEdBQUcsSUFBSSxDQUFDO1FBQzVDLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3RELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDMUQsSUFBQSx3QkFBWSxFQUFDLElBQUksQ0FBQyxFQUNsQixJQUFBLGdDQUFvQixHQUFFLEVBQ3RCLElBQUEsZUFBRyxFQUFDLElBQUksQ0FBQyxFQUFFO1lBQ1QsSUFBSSxDQUFDLCtCQUErQixHQUFHLEtBQUssQ0FBQztZQUM3QyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDakMsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDLENBQUMsRUFDRixJQUFBLHNCQUFVLEVBQUMsR0FBRyxFQUFFO1lBQ2QsSUFBSSxDQUFDLDJCQUEyQixHQUFHLElBQUksQ0FBQztZQUN4QyxJQUFJLENBQUMsK0JBQStCLEdBQUcsS0FBSyxDQUFDO1lBQzdDLE9BQU8sSUFBQSxTQUFFLEVBQUMsRUFBRSxDQUFDLENBQUM7UUFDaEIsQ0FBQyxDQUFDLENBQ0gsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FDakIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLDBCQUFrQixDQUFDLElBQUksQ0FBQyxDQUMvQyxDQUFDO0lBQ0osQ0FBQztJQUVELGVBQWUsQ0FBQyxXQUFtQjtRQUNqQyxXQUFXLEdBQUcsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsb0JBQW9CO1FBQ3RELFdBQVcsR0FBRyxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxtREFBbUQ7UUFDNUYsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsV0FBVyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxZQUFZO1FBQ1YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQztRQUM1QixJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3pCLENBQUM7Ozs7OzswQkF4RUEsZ0JBQVMsU0FBQyxTQUFTO3VCQUNuQixnQkFBUyxTQUFDLGNBQU87OztBQUhQLHdEQUFzQjtpQ0FBdEIsc0JBQXNCO0lBTGxDLElBQUEsZ0JBQVMsRUFBQztRQUNULFFBQVEsRUFBRSxZQUFZO1FBQ3RCLG9EQUE4QztLQUUvQyxDQUFDOzZDQWlCcUMsa0NBQWUsRUFBOEIsc0NBQWlCO0dBaEJ4RixzQkFBc0IsQ0EyRWxDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9nYXJnYW0vRGV2ZWxvcC9ocG8td2ViL3NyYy9hcHAvYnJvd3Nlci9wYWdlcy9wcm9maWxlLXNlYXJjaC9wcm9maWxlLXNlYXJjaC5jb21wb25lbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0VGFibGVEYXRhU291cmNlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvdGFibGUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFVudHlwZWRGb3JtQ29udHJvbCB9IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgZGVib3VuY2VUaW1lLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgZmlsdGVyLCBtYXAsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEFubm90YXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvYW5ub3RhdGlvbi9hbm5vdGF0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgT250b2xvZ3lTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvb250b2xvZ3kvb250b2xvZ3kuc2VydmljZSc7XG5pbXBvcnQgeyBNYXRTdGVwcGVyIH0gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsL3N0ZXBwZXJcIjtcbmltcG9ydCB7IE1hdFNvcnQgfSBmcm9tIFwiQGFuZ3VsYXIvbWF0ZXJpYWwvc29ydFwiO1xuaW1wb3J0IHsgU2ltcGxlVGVybSB9IGZyb20gJy4uLy4uL21vZGVscy9tb2RlbHMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhcHAtY3VzdG9tJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3Byb2ZpbGUtc2VhcmNoLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vcHJvZmlsZS1zZWFyY2guY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBQcm9maWxlU2VhcmNoQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBAVmlld0NoaWxkKCdzdGVwcGVyJykgc3RlcHBlcjogTWF0U3RlcHBlcjtcbiAgQFZpZXdDaGlsZChNYXRTb3J0KSBzb3J0OiBNYXRTb3J0O1xuXG4gIG15Q29udHJvbCA9IG5ldyBVbnR5cGVkRm9ybUNvbnRyb2woKTtcbiAgZmlsdGVyZWRPcHRpb25zOiBPYnNlcnZhYmxlPFNpbXBsZVRlcm1bXT47XG4gIHNlbGVjdGVkVGVybXM6IFNpbXBsZVRlcm1bXSA9IFtdO1xuICBzdWJtaXR0ZWRUZXJtcyA9IGZhbHNlO1xuICBkYXRhU291cmNlOiBNYXRUYWJsZURhdGFTb3VyY2U8U2ltcGxlVGVybT47XG4gIGFzc29jaWF0aW9uRGF0YTtcbiAgbG9hZGluZ0ludGVyc2VjdGluZ0Fzc29jaWF0aW9ucyA9IHRydWU7XG4gIGludGVyc2VjdGluZ0Fzc29jYXRpb25FcnJvciA9IGZhbHNlO1xuICBkaXNwbGF5ZWRDb2x1bW5zOiBzdHJpbmdbXSA9IFsnZGlzZWFzZUlkJywgJ2Rpc2Vhc2VOYW1lJ107XG4gIHJlc3VsdHNMZW5ndGggPSAwO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgb250b2xvZ3lTZXJ2aWNlOiBPbnRvbG9neVNlcnZpY2UsICBwcml2YXRlIGFubm90YXRpb25TZXJ2aWNlOiBBbm5vdGF0aW9uU2VydmljZSkge1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5maWx0ZXJlZE9wdGlvbnMgPSB0aGlzLm15Q29udHJvbC52YWx1ZUNoYW5nZXNcbiAgICAgIC5waXBlKFxuICAgICAgICBmaWx0ZXIoeCA9PiB4ICE9IG51bGwgJiYgeCAhPSAnJyAmJiB4Lmxlbmd0aCA+PSAzKSxcbiAgICAgICAgc3dpdGNoTWFwKHZhbCA9PlxuICAgICAgICAgIHRoaXMub250b2xvZ3lTZXJ2aWNlLnNlYXJjaCh2YWwsIDEwKVxuICAgICAgICApLFxuICAgICAgICBtYXAocmVzcG9uc2UgPT4gcmVzcG9uc2UudGVybXMpXG4gICAgICApO1xuICB9XG5cbiAgYWRkVGVybSh0ZXJtOiBhbnkpIHtcbiAgICBpZiAoIXRoaXMuc2VsZWN0ZWRUZXJtcy5zb21lKGV4aXN0ZW50ID0+IGV4aXN0ZW50LmlkID09IHRlcm0uaWQpKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkVGVybXMucHVzaCh0ZXJtKTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVUZXJtKGluZGV4OiBudW1iZXIpIHtcbiAgICB0aGlzLnNlbGVjdGVkVGVybXMuc3BsaWNlKGluZGV4KTtcbiAgfVxuXG4gIHN1Ym1pdFRlcm1zKCkge1xuICAgIHRoaXMuc3RlcHBlci5uZXh0KCk7XG4gICAgdGhpcy5zdWJtaXR0ZWRUZXJtcyA9IHRydWU7XG4gICAgdGhpcy5sb2FkaW5nSW50ZXJzZWN0aW5nQXNzb2NpYXRpb25zID0gdHJ1ZTtcbiAgICBsZXQgdGVybUlkcyA9IHRoaXMuc2VsZWN0ZWRUZXJtcy5tYXAodGVybSA9PiB0ZXJtLmlkKTtcbiAgICB0aGlzLmFubm90YXRpb25TZXJ2aWNlLnNlYXJjaFByb2ZpbGUodGVybUlkcy5qb2luKFwiLFwiKSkucGlwZShcbiAgICAgIGRlYm91bmNlVGltZSgxMDAwKSxcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICAgICBtYXAoZGF0YSA9PiB7XG4gICAgICAgIHRoaXMubG9hZGluZ0ludGVyc2VjdGluZ0Fzc29jaWF0aW9ucyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlc3VsdHNMZW5ndGggPSBkYXRhLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICB9KSxcbiAgICAgIGNhdGNoRXJyb3IoKCkgPT4ge1xuICAgICAgICB0aGlzLmludGVyc2VjdGluZ0Fzc29jYXRpb25FcnJvciA9IHRydWU7XG4gICAgICAgIHRoaXMubG9hZGluZ0ludGVyc2VjdGluZ0Fzc29jaWF0aW9ucyA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gb2YoW10pO1xuICAgICAgfSlcbiAgICApLnN1YnNjcmliZShkYXRhID0+XG4gICAgICB0aGlzLmRhdGFTb3VyY2UgPSBuZXcgTWF0VGFibGVEYXRhU291cmNlKGRhdGEpXG4gICAgKTtcbiAgfVxuXG4gIGFwcGx5VGVybUZpbHRlcihmaWx0ZXJWYWx1ZTogc3RyaW5nKSB7XG4gICAgZmlsdGVyVmFsdWUgPSBmaWx0ZXJWYWx1ZS50cmltKCk7IC8vIFJlbW92ZSB3aGl0ZXNwYWNlXG4gICAgZmlsdGVyVmFsdWUgPSBmaWx0ZXJWYWx1ZS50b0xvd2VyQ2FzZSgpOyAvLyBNYXRUYWJsZURhdGFTb3VyY2UgZGVmYXVsdHMgdG8gbG93ZXJjYXNlIG1hdGNoZXNcbiAgICB0aGlzLmRhdGFTb3VyY2UuZmlsdGVyID0gZmlsdGVyVmFsdWU7XG4gIH1cblxuICByZXNldFN0ZXBwZXIoKSB7XG4gICAgdGhpcy5zdGVwcGVyLnJlc2V0KCk7XG4gICAgdGhpcy5zdWJtaXR0ZWRUZXJtcyA9IGZhbHNlO1xuICAgIHRoaXMuc2VsZWN0ZWRUZXJtcyA9IFtdO1xuICAgIHRoaXMubXlDb250cm9sLnJlc2V0KCk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==