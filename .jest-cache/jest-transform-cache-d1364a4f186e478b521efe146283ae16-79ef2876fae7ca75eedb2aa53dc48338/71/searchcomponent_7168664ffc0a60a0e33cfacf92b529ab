4384d257454b3446a69cb836ce3fb21a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SearchComponent = void 0;
const tslib_1 = require("tslib");
const router_1 = require("@angular/router");
const core_1 = require("@angular/core");
const search_service_1 = require("../service/search.service");
const animations_1 = require("@angular/animations");
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
let SearchComponent = class SearchComponent {
    constructor(router, searchService) {
        this.router = router;
        this.searchService = searchService;
        this.showHint = false;
        this.terms = [];
        this.diseases = [];
        this.genes = [];
        this.searchstate = 'inactive';
        this.query = new rxjs_1.Subject();
        this.queryString = '';
        this.navFilter = 'all';
        this.notFoundFlag = false;
        this.loadingSearchResults = false;
        this.router = router;
    }
    ngOnInit() {
        this.query.pipe((0, operators_1.debounceTime)(1000), (0, operators_1.distinctUntilChanged)()).subscribe((val) => {
            if (this.hasValidInput(val)) {
                this.loadingSearchResults = true;
                this.queryText = val;
                this.searchService.searchAll(val).subscribe(({ terms, genes, diseases }) => {
                    this.terms = terms.terms;
                    this.diseases = diseases.results;
                    this.genes = genes.results;
                    this.termsCount = terms.totalCount;
                    this.diseasesCount = diseases.totalCount;
                    this.genesCount = genes.totalCount;
                    this.notFoundFlag = (this.terms.length === 0 && this.diseases.length === 0 && this.genes.length === 0);
                    this.searchstate = 'active';
                }, (error) => {
                    console.log(error);
                    this.loadingSearchResults = false;
                }, () => {
                    this.loadingSearchResults = false;
                });
            }
            else {
                this.searchstate = 'inactive';
            }
        }); // End debounce subscribe
    }
    contentChanging(input) {
        this.query.next(input);
    }
    setQuery(term) {
        this.queryString = term;
        this.contentChanging(term);
        this.searchBar.nativeElement.focus();
    }
    hasValidInput(qString) {
        return (qString && qString.length >= 3);
    }
    toggleDropdown(target) {
        if (this.searchstate === 'inactive' && this.hasValidInput(this.queryString)) {
            this.searchstate = 'active';
            return;
        }
        else if (target.relatedTarget != null) {
            if (target.relatedTarget.className.includes('result')) {
                return;
            }
        }
        this.searchstate = 'inactive';
    }
    // Submit query to search results page
    submitQuery(input) {
        if (this.searchstate === 'active') {
            this.searchstate = 'inactive';
        }
        this.router.navigate(['/browse/search'], { queryParams: { q: input, navFilter: this.navFilter } });
    }
    isCorrectCategory(filter) {
        return (filter === this.navFilter || this.navFilter === 'all');
    }
    // Hack because blur on input will cancel router link apparently.
    closeDropDown() {
        this.searchstate = 'inactive';
    }
    dbOnly(id) {
        return id.split(":")[0];
    }
    static { this.ctorParameters = () => [
        { type: router_1.Router },
        { type: search_service_1.SearchService }
    ]; }
    static { this.propDecorators = {
        showHint: [{ type: core_1.Input }],
        searchBar: [{ type: core_1.ViewChild, args: ['searchbar', { static: true },] }]
    }; }
};
exports.SearchComponent = SearchComponent;
exports.SearchComponent = SearchComponent = tslib_1.__decorate([
    (0, core_1.Component)({
        selector: 'app-search-bar',
        template: require("./search.component.html"),
        animations: [
            (0, animations_1.trigger)('searchState', [
                (0, animations_1.state)('inactive', (0, animations_1.style)({
                    'height': 0,
                    'overflow-y': 'hidden',
                    'visibility': 'hidden'
                })),
                (0, animations_1.state)('active', (0, animations_1.style)({
                    'max-height': '750px',
                    'overflow-y': 'scroll',
                    'visibility': 'visible'
                })),
                (0, animations_1.transition)('inactive => active', (0, animations_1.animate)('500ms ease-in-out')),
                (0, animations_1.transition)('active => inactive', (0, animations_1.animate)('200ms ease-in-out'))
            ])
        ]
    }),
    tslib_1.__metadata("design:paramtypes", [router_1.Router, search_service_1.SearchService])
], SearchComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dhcmdhbS9EZXZlbG9wL2hwby13ZWIvc3JjL2FwcC9zaGFyZWQvc2VhcmNoL3NlYXJjaC9zZWFyY2guY29tcG9uZW50LnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQSw0Q0FBeUM7QUFDekMsd0NBQWdGO0FBRWhGLDhEQUEwRDtBQUUxRCxvREFBaUY7QUFDakYsK0JBQStCO0FBQy9CLDhDQUFvRTtBQXlCN0QsSUFBTSxlQUFlLEdBQXJCLE1BQU0sZUFBZTtJQW1CMUIsWUFBb0IsTUFBYyxFQUFVLGFBQTRCO1FBQXBELFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQWpCL0QsYUFBUSxHQUFHLEtBQUs7UUFDekIsVUFBSyxHQUFXLEVBQUUsQ0FBQztRQUNuQixhQUFRLEdBQWlCLEVBQUUsQ0FBQztRQUM1QixVQUFLLEdBQWlCLEVBQUUsQ0FBQztRQUl6QixnQkFBVyxHQUFHLFVBQVUsQ0FBQztRQUN6QixVQUFLLEdBQUcsSUFBSSxjQUFPLEVBQUUsQ0FBQztRQUN0QixnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUNqQixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBRWxCLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBQ3JCLHlCQUFvQixHQUFHLEtBQUssQ0FBQztRQUszQixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUEsd0JBQVksRUFBQyxJQUFJLENBQUMsRUFDaEMsSUFBQSxnQ0FBb0IsR0FBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBVyxFQUFFLEVBQUU7WUFDbEQsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUM7Z0JBQ2pDLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFBO2dCQUdwQixJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRTtvQkFDekUsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDO29CQUN6QixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUM7b0JBQ2pDLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQztvQkFDM0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO29CQUNuQyxJQUFJLENBQUMsYUFBYSxHQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUM7b0JBQ3pDLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQztvQkFDbkMsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUM7b0JBQ3ZHLElBQUksQ0FBQyxXQUFXLEdBQUcsUUFBUSxDQUFDO2dCQUM5QixDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRTtvQkFDWCxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNuQixJQUFJLENBQUMsb0JBQW9CLEdBQUcsS0FBSyxDQUFDO2dCQUNwQyxDQUFDLEVBQUUsR0FBRyxFQUFFO29CQUNOLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxLQUFLLENBQUM7Z0JBQ3BDLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLElBQUksQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO1lBQ2hDLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQyxDQUFDLHlCQUF5QjtJQUMvQixDQUFDO0lBRUQsZUFBZSxDQUFDLEtBQWE7UUFDM0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUVELFFBQVEsQ0FBQyxJQUFZO1FBQ25CLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDdkMsQ0FBQztJQUVELGFBQWEsQ0FBQyxPQUFlO1FBQzNCLE9BQU8sQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsY0FBYyxDQUFDLE1BQVc7UUFDeEIsSUFBSSxJQUFJLENBQUMsV0FBVyxLQUFLLFVBQVUsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1lBQzVFLElBQUksQ0FBQyxXQUFXLEdBQUcsUUFBUSxDQUFDO1lBQzVCLE9BQU87UUFDVCxDQUFDO2FBQU0sSUFBSSxNQUFNLENBQUMsYUFBYSxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ3hDLElBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7Z0JBQ3RELE9BQU87WUFDVCxDQUFDO1FBQ0gsQ0FBQztRQUNELElBQUksQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO0lBQ2hDLENBQUM7SUFFRCxzQ0FBc0M7SUFDdEMsV0FBVyxDQUFDLEtBQWE7UUFDdkIsSUFBSSxJQUFJLENBQUMsV0FBVyxLQUFLLFFBQVEsRUFBRSxDQUFDO1lBQ2xDLElBQUksQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO1FBQ2hDLENBQUM7UUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLEVBQUUsRUFBRSxXQUFXLEVBQUUsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3JHLENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxNQUFjO1FBQzlCLE9BQU8sQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxLQUFLLEtBQUssQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFFRCxpRUFBaUU7SUFDakUsYUFBYTtRQUNYLElBQUksQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO0lBQ2hDLENBQUM7SUFFRCxNQUFNLENBQUMsRUFBVTtRQUNmLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMxQixDQUFDOzs7Ozs7MkJBL0ZBLFlBQUs7NEJBZUwsZ0JBQVMsU0FBQyxXQUFXLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzs7QUFqQjdCLDBDQUFlOzBCQUFmLGVBQWU7SUF2QjNCLElBQUEsZ0JBQVMsRUFBQztRQUNULFFBQVEsRUFBRSxnQkFBZ0I7UUFDMUIsNENBQXNDO1FBRXRDLFVBQVUsRUFBRTtZQUNWLElBQUEsb0JBQU8sRUFBQyxhQUFhLEVBQUU7Z0JBQ3JCLElBQUEsa0JBQUssRUFBQyxVQUFVLEVBQUUsSUFBQSxrQkFBSyxFQUFDO29CQUN0QixRQUFRLEVBQUUsQ0FBQztvQkFDWCxZQUFZLEVBQUUsUUFBUTtvQkFDdEIsWUFBWSxFQUFFLFFBQVE7aUJBQ3ZCLENBQUMsQ0FBQztnQkFDSCxJQUFBLGtCQUFLLEVBQUMsUUFBUSxFQUFFLElBQUEsa0JBQUssRUFBQztvQkFDcEIsWUFBWSxFQUFFLE9BQU87b0JBQ3JCLFlBQVksRUFBRSxRQUFRO29CQUN0QixZQUFZLEVBQUUsU0FBUztpQkFDeEIsQ0FBQyxDQUFDO2dCQUNILElBQUEsdUJBQVUsRUFBQyxvQkFBb0IsRUFDN0IsSUFBQSxvQkFBTyxFQUFDLG1CQUFtQixDQUFDLENBQUM7Z0JBQy9CLElBQUEsdUJBQVUsRUFBQyxvQkFBb0IsRUFDN0IsSUFBQSxvQkFBTyxFQUFDLG1CQUFtQixDQUFDLENBQUM7YUFDaEMsQ0FBQztTQUNIO0tBQ0YsQ0FBQzs2Q0FvQjRCLGVBQU0sRUFBeUIsOEJBQWE7R0FuQjdELGVBQWUsQ0FrRzNCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9nYXJnYW0vRGV2ZWxvcC9ocG8td2ViL3NyYy9hcHAvc2hhcmVkL3NlYXJjaC9zZWFyY2gvc2VhcmNoLmNvbXBvbmVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERpc2Vhc2UsIEdlbmUsIFNpbXBsZVRlcm0sIFRlcm0gfSBmcm9tICcuLi8uLi8uLi9icm93c2VyL21vZGVscy9tb2RlbHMnO1xuaW1wb3J0IHsgU2VhcmNoU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2Uvc2VhcmNoLnNlcnZpY2UnO1xuXG5pbXBvcnQgeyBhbmltYXRlLCBzdGF0ZSwgc3R5bGUsIHRyYW5zaXRpb24sIHRyaWdnZXIgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgZGlzdGluY3RVbnRpbENoYW5nZWQgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FwcC1zZWFyY2gtYmFyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3NlYXJjaC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3NlYXJjaC5jb21wb25lbnQuc2NzcyddLFxuICBhbmltYXRpb25zOiBbXG4gICAgdHJpZ2dlcignc2VhcmNoU3RhdGUnLCBbXG4gICAgICBzdGF0ZSgnaW5hY3RpdmUnLCBzdHlsZSh7XG4gICAgICAgICdoZWlnaHQnOiAwLFxuICAgICAgICAnb3ZlcmZsb3cteSc6ICdoaWRkZW4nLFxuICAgICAgICAndmlzaWJpbGl0eSc6ICdoaWRkZW4nXG4gICAgICB9KSksXG4gICAgICBzdGF0ZSgnYWN0aXZlJywgc3R5bGUoe1xuICAgICAgICAnbWF4LWhlaWdodCc6ICc3NTBweCcsXG4gICAgICAgICdvdmVyZmxvdy15JzogJ3Njcm9sbCcsXG4gICAgICAgICd2aXNpYmlsaXR5JzogJ3Zpc2libGUnXG4gICAgICB9KSksXG4gICAgICB0cmFuc2l0aW9uKCdpbmFjdGl2ZSA9PiBhY3RpdmUnLFxuICAgICAgICBhbmltYXRlKCc1MDBtcyBlYXNlLWluLW91dCcpKSxcbiAgICAgIHRyYW5zaXRpb24oJ2FjdGl2ZSA9PiBpbmFjdGl2ZScsXG4gICAgICAgIGFuaW1hdGUoJzIwMG1zIGVhc2UtaW4tb3V0JykpXG4gICAgXSlcbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBTZWFyY2hDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIEBJbnB1dCgpIHNob3dIaW50ID0gZmFsc2U7XG4gIHRlcm1zOiBUZXJtW10gPSBbXTtcbiAgZGlzZWFzZXM6IFNpbXBsZVRlcm1bXSA9IFtdO1xuICBnZW5lczogU2ltcGxlVGVybVtdID0gW107XG4gIHRlcm1zQ291bnQ6IG51bWJlcjtcbiAgZGlzZWFzZXNDb3VudDogbnVtYmVyO1xuICBnZW5lc0NvdW50OiBudW1iZXI7XG4gIHNlYXJjaHN0YXRlID0gJ2luYWN0aXZlJztcbiAgcXVlcnkgPSBuZXcgU3ViamVjdCgpO1xuICBxdWVyeVN0cmluZyA9ICcnO1xuICBuYXZGaWx0ZXIgPSAnYWxsJztcbiAgcXVlcnlUZXh0OiBzdHJpbmc7XG4gIG5vdEZvdW5kRmxhZyA9IGZhbHNlO1xuICBsb2FkaW5nU2VhcmNoUmVzdWx0cyA9IGZhbHNlO1xuXG4gIEBWaWV3Q2hpbGQoJ3NlYXJjaGJhcicsIHsgc3RhdGljOiB0cnVlIH0pIHNlYXJjaEJhcjogRWxlbWVudFJlZjtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlcjogUm91dGVyLCBwcml2YXRlIHNlYXJjaFNlcnZpY2U6IFNlYXJjaFNlcnZpY2UpIHtcbiAgICB0aGlzLnJvdXRlciA9IHJvdXRlcjtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucXVlcnkucGlwZShkZWJvdW5jZVRpbWUoMTAwMCksXG4gICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpKS5zdWJzY3JpYmUoKHZhbDogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAodGhpcy5oYXNWYWxpZElucHV0KHZhbCkpIHtcbiAgICAgICAgdGhpcy5sb2FkaW5nU2VhcmNoUmVzdWx0cyA9IHRydWU7XG4gICAgICAgIHRoaXMucXVlcnlUZXh0ID0gdmFsXG5cblxuICAgICAgICB0aGlzLnNlYXJjaFNlcnZpY2Uuc2VhcmNoQWxsKHZhbCkuc3Vic2NyaWJlKCh7IHRlcm1zLCBnZW5lcywgZGlzZWFzZXMgfSkgPT4ge1xuICAgICAgICAgIHRoaXMudGVybXMgPSB0ZXJtcy50ZXJtcztcbiAgICAgICAgICB0aGlzLmRpc2Vhc2VzID0gZGlzZWFzZXMucmVzdWx0cztcbiAgICAgICAgICB0aGlzLmdlbmVzID0gZ2VuZXMucmVzdWx0cztcbiAgICAgICAgICB0aGlzLnRlcm1zQ291bnQgPSB0ZXJtcy50b3RhbENvdW50O1xuICAgICAgICAgIHRoaXMuZGlzZWFzZXNDb3VudCA9IGRpc2Vhc2VzLnRvdGFsQ291bnQ7XG4gICAgICAgICAgdGhpcy5nZW5lc0NvdW50ID0gZ2VuZXMudG90YWxDb3VudDtcbiAgICAgICAgICB0aGlzLm5vdEZvdW5kRmxhZyA9ICh0aGlzLnRlcm1zLmxlbmd0aCA9PT0gMCAmJiB0aGlzLmRpc2Vhc2VzLmxlbmd0aCA9PT0gMCAmJiB0aGlzLmdlbmVzLmxlbmd0aCA9PT0gMCk7XG4gICAgICAgICAgdGhpcy5zZWFyY2hzdGF0ZSA9ICdhY3RpdmUnO1xuICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VhcmNoUmVzdWx0cyA9IGZhbHNlO1xuICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VhcmNoUmVzdWx0cyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2VhcmNoc3RhdGUgPSAnaW5hY3RpdmUnO1xuICAgICAgfVxuICAgIH0pOyAvLyBFbmQgZGVib3VuY2Ugc3Vic2NyaWJlXG4gIH1cblxuICBjb250ZW50Q2hhbmdpbmcoaW5wdXQ6IHN0cmluZykge1xuICAgIHRoaXMucXVlcnkubmV4dChpbnB1dCk7XG4gIH1cblxuICBzZXRRdWVyeSh0ZXJtOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnF1ZXJ5U3RyaW5nID0gdGVybTtcbiAgICB0aGlzLmNvbnRlbnRDaGFuZ2luZyh0ZXJtKTtcbiAgICB0aGlzLnNlYXJjaEJhci5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gIH1cblxuICBoYXNWYWxpZElucHV0KHFTdHJpbmc6IHN0cmluZykge1xuICAgIHJldHVybiAocVN0cmluZyAmJiBxU3RyaW5nLmxlbmd0aCA+PSAzKTtcbiAgfVxuXG4gIHRvZ2dsZURyb3Bkb3duKHRhcmdldDogYW55KSB7XG4gICAgaWYgKHRoaXMuc2VhcmNoc3RhdGUgPT09ICdpbmFjdGl2ZScgJiYgdGhpcy5oYXNWYWxpZElucHV0KHRoaXMucXVlcnlTdHJpbmcpKSB7XG4gICAgICB0aGlzLnNlYXJjaHN0YXRlID0gJ2FjdGl2ZSc7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmICh0YXJnZXQucmVsYXRlZFRhcmdldCAhPSBudWxsKSB7XG4gICAgICBpZiAodGFyZ2V0LnJlbGF0ZWRUYXJnZXQuY2xhc3NOYW1lLmluY2x1ZGVzKCdyZXN1bHQnKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuc2VhcmNoc3RhdGUgPSAnaW5hY3RpdmUnO1xuICB9XG5cbiAgLy8gU3VibWl0IHF1ZXJ5IHRvIHNlYXJjaCByZXN1bHRzIHBhZ2VcbiAgc3VibWl0UXVlcnkoaW5wdXQ6IHN0cmluZykge1xuICAgIGlmICh0aGlzLnNlYXJjaHN0YXRlID09PSAnYWN0aXZlJykge1xuICAgICAgdGhpcy5zZWFyY2hzdGF0ZSA9ICdpbmFjdGl2ZSc7XG4gICAgfVxuICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnL2Jyb3dzZS9zZWFyY2gnXSwgeyBxdWVyeVBhcmFtczogeyBxOiBpbnB1dCwgbmF2RmlsdGVyOiB0aGlzLm5hdkZpbHRlciB9IH0pO1xuICB9XG5cbiAgaXNDb3JyZWN0Q2F0ZWdvcnkoZmlsdGVyOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gKGZpbHRlciA9PT0gdGhpcy5uYXZGaWx0ZXIgfHwgdGhpcy5uYXZGaWx0ZXIgPT09ICdhbGwnKTtcbiAgfVxuXG4gIC8vIEhhY2sgYmVjYXVzZSBibHVyIG9uIGlucHV0IHdpbGwgY2FuY2VsIHJvdXRlciBsaW5rIGFwcGFyZW50bHkuXG4gIGNsb3NlRHJvcERvd24oKSB7XG4gICAgdGhpcy5zZWFyY2hzdGF0ZSA9ICdpbmFjdGl2ZSc7XG4gIH1cblxuICBkYk9ubHkoaWQ6IHN0cmluZykge1xuICAgIHJldHVybiBpZC5zcGxpdChcIjpcIilbMF07XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==