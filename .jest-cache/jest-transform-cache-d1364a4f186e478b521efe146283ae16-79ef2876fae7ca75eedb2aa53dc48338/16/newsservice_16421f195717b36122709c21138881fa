9d75dbbf581a547ea5cde5aea1f9ae5c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NewsService = void 0;
const tslib_1 = require("tslib");
const core_1 = require("@angular/core");
const http_1 = require("@angular/common/http");
const environment_1 = require("../../../environments/environment");
const operators_1 = require("rxjs/operators");
let NewsService = class NewsService {
    constructor(http) {
        this.http = http;
        this.options = {
            headers: new http_1.HttpHeaders({
                'Content-Type': 'application/json',
                'Accept': 'q=0.8;application/json;q=0.9'
            })
        };
    }
    /* Return a specific months news */
    getNewsByDate(date) {
        if (date) {
            return this.getNews().pipe((0, operators_1.map)(news => news[date]));
        }
    }
    /* Return all unique month-years with news*/
    getUniqueDates() {
        return this.getNews().pipe((0, operators_1.map)(news => this._getDates(news)));
    }
    /* Return all month years */
    _getDates(news) {
        return Object.keys(news);
    }
    /* Get the teaser news for homepage */
    getTeaserNews() {
        return this.getNews().pipe((0, operators_1.map)(news => this.selectTeasers(news)));
    }
    /* Get the 3 most recent news items */
    selectTeasers(allNews) {
        let news = Object.keys(allNews).map(key => allNews[key]);
        news = [].concat.apply([], news);
        news.sort((a, b) => {
            const a1 = new Date(a.date);
            const b1 = new Date(b.date);
            return a1 > b1 ? -1 : a1 < b1 ? 1 : 0;
        });
        news.forEach(function (item) {
            const monthYear = item.date.split(',');
            item.monthYear = monthYear[0].split(' ')[0] + monthYear[1];
        });
        return news.slice(0, 3);
    }
    /* Get news items from github and store it as a "cache" */
    getNews() {
        if (!this.newsObservable$) {
            this.newsObservable$ = this.http.get(environment_1.environment.HPO_NEWS_JSON_URL).pipe((0, operators_1.publishReplay)(1), (0, operators_1.refCount)());
        }
        return this.newsObservable$;
    }
    /* Get the news items from the api */
    setAllNews(news) {
        this.allNews = news;
    }
    static { this.ctorParameters = () => [
        { type: http_1.HttpClient }
    ]; }
};
exports.NewsService = NewsService;
exports.NewsService = NewsService = tslib_1.__decorate([
    (0, core_1.Injectable)(),
    tslib_1.__metadata("design:paramtypes", [http_1.HttpClient])
], NewsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dhcmdhbS9EZXZlbG9wL2hwby13ZWIvc3JjL2FwcC9zaGFyZWQvbmV3cy9uZXdzLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLHdDQUEyQztBQUczQywrQ0FBK0Q7QUFDL0QsbUVBQWdFO0FBQ2hFLDhDQUE4RDtBQUd2RCxJQUFNLFdBQVcsR0FBakIsTUFBTSxXQUFXO0lBVXRCLFlBQW9CLElBQWdCO1FBQWhCLFNBQUksR0FBSixJQUFJLENBQVk7UUFQcEMsWUFBTyxHQUFHO1lBQ1IsT0FBTyxFQUFFLElBQUksa0JBQVcsQ0FBQztnQkFDdkIsY0FBYyxFQUFFLGtCQUFrQjtnQkFDbEMsUUFBUSxFQUFFLDhCQUE4QjthQUN6QyxDQUFDO1NBQ0gsQ0FBQztJQUdGLENBQUM7SUFHRCxtQ0FBbUM7SUFDbkMsYUFBYSxDQUFDLElBQVk7UUFDeEIsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNULE9BQU8sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FDeEIsSUFBQSxlQUFHLEVBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FDeEIsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0lBRUQsNENBQTRDO0lBQzVDLGNBQWM7UUFDWixPQUFPLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQ3hCLElBQUEsZUFBRyxFQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUNsQyxDQUFDO0lBQ0osQ0FBQztJQUVELDRCQUE0QjtJQUM1QixTQUFTLENBQUMsSUFBWTtRQUNwQixPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELHNDQUFzQztJQUN0QyxhQUFhO1FBQ1gsT0FBTyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUN4QixJQUFBLGVBQUcsRUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FDdEMsQ0FBQztJQUNKLENBQUM7SUFFRCxzQ0FBc0M7SUFDdEMsYUFBYSxDQUFDLE9BQWU7UUFDM0IsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN6RCxJQUFJLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDakIsTUFBTSxFQUFFLEdBQUcsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVCLE1BQU0sRUFBRSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1QixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxJQUFJO1lBQ3pCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0QsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFFRCwwREFBMEQ7SUFDMUQsT0FBTztRQUNMLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDMUIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyx5QkFBVyxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUN0RSxJQUFBLHlCQUFhLEVBQUMsQ0FBQyxDQUFDLEVBQ2hCLElBQUEsb0JBQVEsR0FBRSxDQUNYLENBQUM7UUFDSixDQUFDO1FBQ0QsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDO0lBQzlCLENBQUM7SUFFRCxxQ0FBcUM7SUFDckMsVUFBVSxDQUFDLElBQVk7UUFDckIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFDdEIsQ0FBQzs7Ozs7QUF4RVUsa0NBQVc7c0JBQVgsV0FBVztJQUR2QixJQUFBLGlCQUFVLEdBQUU7NkNBV2UsaUJBQVU7R0FWekIsV0FBVyxDQXlFdkIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2dhcmdhbS9EZXZlbG9wL2hwby13ZWIvc3JjL2FwcC9zaGFyZWQvbmV3cy9uZXdzLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmV3cyB9IGZyb20gJy4uLy4uL2Jyb3dzZXIvbW9kZWxzL21vZGVscyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwSGVhZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IGVudmlyb25tZW50IH0gZnJvbSAnLi4vLi4vLi4vZW52aXJvbm1lbnRzL2Vudmlyb25tZW50JztcbmltcG9ydCB7IG1hcCwgcHVibGlzaFJlcGxheSwgcmVmQ291bnQgfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE5ld3NTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBhbGxOZXdzOiBhbnk7XG4gIHByaXZhdGUgbmV3c09ic2VydmFibGUkOiBhbnk7XG4gIG9wdGlvbnMgPSB7XG4gICAgaGVhZGVyczogbmV3IEh0dHBIZWFkZXJzKHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAnQWNjZXB0JzogJ3E9MC44O2FwcGxpY2F0aW9uL2pzb247cT0wLjknXG4gICAgfSlcbiAgfTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHtcbiAgfVxuXG5cbiAgLyogUmV0dXJuIGEgc3BlY2lmaWMgbW9udGhzIG5ld3MgKi9cbiAgZ2V0TmV3c0J5RGF0ZShkYXRlOiBzdHJpbmcpOiBPYnNlcnZhYmxlPE5ld3NbXT4ge1xuICAgIGlmIChkYXRlKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXROZXdzKCkucGlwZShcbiAgICAgICAgbWFwKG5ld3MgPT4gbmV3c1tkYXRlXSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyogUmV0dXJuIGFsbCB1bmlxdWUgbW9udGgteWVhcnMgd2l0aCBuZXdzKi9cbiAgZ2V0VW5pcXVlRGF0ZXMoKTogT2JzZXJ2YWJsZTxBcnJheTxzdHJpbmc+PiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0TmV3cygpLnBpcGUoXG4gICAgICBtYXAobmV3cyA9PiB0aGlzLl9nZXREYXRlcyhuZXdzKSlcbiAgICApO1xuICB9XG5cbiAgLyogUmV0dXJuIGFsbCBtb250aCB5ZWFycyAqL1xuICBfZ2V0RGF0ZXMobmV3czogTmV3c1tdKTogQXJyYXk8c3RyaW5nPiB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKG5ld3MpO1xuICB9XG5cbiAgLyogR2V0IHRoZSB0ZWFzZXIgbmV3cyBmb3IgaG9tZXBhZ2UgKi9cbiAgZ2V0VGVhc2VyTmV3cygpOiBPYnNlcnZhYmxlPE5ld3NbXT4ge1xuICAgIHJldHVybiB0aGlzLmdldE5ld3MoKS5waXBlKFxuICAgICAgbWFwKG5ld3MgPT4gdGhpcy5zZWxlY3RUZWFzZXJzKG5ld3MpKVxuICAgICk7XG4gIH1cblxuICAvKiBHZXQgdGhlIDMgbW9zdCByZWNlbnQgbmV3cyBpdGVtcyAqL1xuICBzZWxlY3RUZWFzZXJzKGFsbE5ld3M6IE5ld3NbXSkge1xuICAgIGxldCBuZXdzID0gT2JqZWN0LmtleXMoYWxsTmV3cykubWFwKGtleSA9PiBhbGxOZXdzW2tleV0pO1xuICAgIG5ld3MgPSBbXS5jb25jYXQuYXBwbHkoW10sIG5ld3MpO1xuICAgIG5ld3Muc29ydCgoYSwgYikgPT4ge1xuICAgICAgY29uc3QgYTEgPSBuZXcgRGF0ZShhLmRhdGUpO1xuICAgICAgY29uc3QgYjEgPSBuZXcgRGF0ZShiLmRhdGUpO1xuICAgICAgcmV0dXJuIGExID4gYjEgPyAtMSA6IGExIDwgYjEgPyAxIDogMDtcbiAgICB9KTtcbiAgICBuZXdzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGNvbnN0IG1vbnRoWWVhciA9IGl0ZW0uZGF0ZS5zcGxpdCgnLCcpO1xuICAgICAgaXRlbS5tb250aFllYXIgPSBtb250aFllYXJbMF0uc3BsaXQoJyAnKVswXSArIG1vbnRoWWVhclsxXTtcbiAgICB9KTtcbiAgICByZXR1cm4gbmV3cy5zbGljZSgwLCAzKTtcbiAgfVxuXG4gIC8qIEdldCBuZXdzIGl0ZW1zIGZyb20gZ2l0aHViIGFuZCBzdG9yZSBpdCBhcyBhIFwiY2FjaGVcIiAqL1xuICBnZXROZXdzKCk6IE9ic2VydmFibGU8TmV3c1tdPiB7XG4gICAgaWYgKCF0aGlzLm5ld3NPYnNlcnZhYmxlJCkge1xuICAgICAgdGhpcy5uZXdzT2JzZXJ2YWJsZSQgPSB0aGlzLmh0dHAuZ2V0KGVudmlyb25tZW50LkhQT19ORVdTX0pTT05fVVJMKS5waXBlKFxuICAgICAgICBwdWJsaXNoUmVwbGF5KDEpLFxuICAgICAgICByZWZDb3VudCgpXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5uZXdzT2JzZXJ2YWJsZSQ7XG4gIH1cblxuICAvKiBHZXQgdGhlIG5ld3MgaXRlbXMgZnJvbSB0aGUgYXBpICovXG4gIHNldEFsbE5ld3MobmV3czogTmV3c1tdKTogdm9pZCB7XG4gICAgdGhpcy5hbGxOZXdzID0gbmV3cztcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9